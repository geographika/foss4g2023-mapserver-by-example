<section data-markdown>
    <script type="text/template">
        ## Mapfiles by Example

        Examples from
        <a href="https://twitter.com/mapserverstudio" target="_blank"><img class="plain" src="images/langfr-1280px-Twitter_Bird.svg.png" style="background: none;vertical-align:middle;height: 24px" />@mapserverstudio</a>
        [#30DayMapChallenge](https://twitter.com/hashtag/30DayMapChallenge)
    </script>
</section>

<section data-background="images/space-map.png">
    <h1 style="color:white">Space</h1>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="5-6|7|8-11">
LAYER
  TYPE POINT
  NAME "constellations"
  STATUS ON
  CONNECTIONTYPE OGR
  CONNECTION "/vsicurl/https://raw.githubusercontent.com/ofrohn/d3-celestial/master/data/stars.14.json"
  PROCESSING "NATIVE_FILTER=mag>12"
  COMPOSITE
    COMPFILTER "blur(5)"
    OPACITY 90
  END
  CLASS
    STYLE
      SYMBOL "circle"
      COLOR "#ffcd3c" # unnamed
      SIZE [mag]
    END
  END
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Read GeoJSON from GitHub
            - Filter the GeoJSON
            - Make a blurry star effect
        </script>
    </span>
</section>

<section data-background-image="images/filegdb_states_green.png" data-background-size="90%">
    <h2 style="color:white">FlatGeoBuffers and COLORRANGE</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="7-9|14-15">
MAP
  NAME "FlatGeoBuf"
  EXTENT -125.19682772605225 17.74964753282352 -66.3649974199852 62.066682932234244
  PROJECTION
    "init=epsg:26915"
  END
  CONFIG "AWS_ACCESS_KEY_ID" "XXXXX"
  CONFIG "AWS_SECRET_ACCESS_KEY" "XXXXX"
  CONFIG "AWS_S3_ENDPOINT" "XXXXX"
  LAYER
    NAME "UScounties"
    TYPE POLYGON
    STATUS ON
    CONNECTIONTYPE OGR # data from https://github.com/flatgeobuf/flatgeobuf/tree/master/test/data
    CONNECTION "/vsis3/mapserverstudio/data/UScounties.fgb"
    PROJECTION
      "init=epsg:26915"
    END
    CLASS
      STYLE
        OUTLINECOLOR "#c8c8c8"
      END
    END
  END
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Configure access to a secure S3 bucket
            - Connect to a remote FlatGeoBuffers file
        </script>
    </span>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="4|5-6">
CLASS
    STYLE
        OUTLINECOLOR 200 200 200
        RANGEITEM "COUNTY_FIP"
        COLORRANGE "#063b00" "#0eff00"
        DATARANGE 0 500
    END
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            #### Colour Range

            - Use a feature attribute
            - Set a start and end colour and map to a data range
        </script>
    </span>
</section>

<section data-background-image="images/disputed_areas.png">
    <h2 style="color:black">Hatching and Leader Lines</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="1-4|6-16">
SYMBOL
    NAME "hatchsymbol"
    TYPE HATCH
END

STYLE
    SYMBOL "hatchsymbol"
    COLOR "#DC143C"
    WIDTH 0.4
    ANGLE 45
    SIZE 3
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Define the HATCH symbol
            - Configure the hatching
            - https://app.mapserverstudio.net/#i8eY58sZ
        </script>
    </span>
</section>

<section data-background-image="images/contours2.png">
    <h2 style="color:black">Contours</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="5-6|8-9">
LAYER
    NAME "contours"
    TYPE LINE
    STATUS ON
    CONNECTIONTYPE CONTOUR
    DATA "/data/copernicus/eu_dem_v11_E10N00.TIF"
    PROCESSING "BANDS=1"
    PROCESSING "CONTOUR_ITEM=elevation"
    PROCESSING "CONTOUR_INTERVAL=10"
    CLASS
        STYLE
            WIDTH 0.4
            COLOR 50 50 50
        END
    END
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Use a CONTOUR CONNECTIONTYPE
            - Set the raster DEM datasource
            - Configure the contour intervals, GDAL handles the rest
            - https://app.mapserverstudio.net/#iSCZaMdN
        </script>
    </span>
</section>

<section data-background-image="images/polar_graticules.png">
    <h2 style="color:black">Graticules</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="4-6|7-10|13-24">
LAYER
    NAME "grid"
    TYPE LINE
    PROJECTION
        "init=epsg:3857"
    END
    GRID
        MININTERVAL 1000000
        LABELFORMAT "%.fm"
    END
    CLASS
        NAME "Graticule"
        STYLE
            COLOR 70 70 70
        END
        LABEL
            FONT "Baskervville"
            OUTLINEWIDTH 3
            OUTLINECOLOR 255 255 255
            TYPE TRUETYPE
            SIZE 12
            ANGLE FOLLOW
            BUFFER 10
        END
    END
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Use a different projection from the map
            - Add a GRID configuration to a LAYER
            - Style the GRID and add labels
            - https://app.mapserverstudio.net/#WqW8rb8i
        </script>
    </span>
</section>

<section data-background-image="images/raster.png">
    <h2 style="color:black">Raster Data</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="2-5|8|9|11-18">
MAP
    CONFIG "AWS_ACCESS_KEY_ID" "XXXX"
    CONFIG "AWS_SECRET_ACCESS_KEY" "XXX"
    CONFIG "AWS_REQUEST_PAYER" "requester"
    CONFIG "AWS_S3_ENDPOINT" "s3.amazonaws.com"
    LAYER
        NAME "RasterLayer"
        TYPE RASTER
        DATA "/vsis3/sentinel-cogs/sentinel-s2-l2a-cogs/34/T/DM/2023/6/S2B_34TDM_20230615_0_L2A/B02.tif"
        STATUS ON
        CLASS
            NAME "colorramp"
            STYLE
                COLORRANGE "#264cff" "#ffffbf"
                DATARANGE 1346 13578
                RANGEITEM "value_0"
            END
        END
...
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Add the AWS settings
            - Create a LAYER of TYPE RASTER
            - Set a DATA source of a raster in a s3 bucket
            - Style the raster using a COLORRANGE across a DATARANGE
            - https://app.mapserverstudio.net/#57BaUuL1
        </script>
    </span>
</section>

<section data-background-image="images/raster_analysis.png">
    <h2 style="color:black">Raster Analysis</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="3-4|8|9-14">
LAYER
    NAME "Difference"
    TYPE RASTER
    CONNECTIONTYPE OGR
    DATA "
    <VRTDataset rasterXSize='8640' rasterYSize='4320'>
    <VRTRasterBand dataType='Float32' band='1' subClass='VRTDerivedRasterBand'>
    <PixelFunctionType>diff</PixelFunctionType>
    <SimpleSource>
    <SourceFilename>/data/raster/wc2.1_2.5m_tmax_2021-06.tif</SourceFilename>
            </SimpleSource>
    <SimpleSource>
    <SourceFilename>/data/raster/wc2.1_2.5m_tmax_1960-06.tif</SourceFilename>
            </SimpleSource>
        </VRTRasterBand>
    </VRTDataset>
    "
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Create a RASTER OGR layer
            - Use GDAL's `diff` pixel function
            - Add in the two source rasters as GDAL Virtual Format sources
            - https://app.mapserverstudio.net/#9JBVADFh
        </script>
    </span>
</section>

<section data-background-image="images/pie-charts-map.png" data-background-size="60%">
    <h2 style="color:black">Dynamic Pie Charts</h2>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="9-10|20|25-27">
    LAYER
        NAME "charts"
        PROJECTION
            "init=epsg:4326"
        END
        STATUS ON
        CONNECTIONTYPE OGR
        CONNECTION "<OGRVRTDataSource>
    <OGRVRTLayer name='joined'>
    <SrcDataSource shared='TRUE'><![CDATA[<OGRVRTDataSource>
    <OGRVRTLayer name='countries'>
    <SrcDataSource>/vsis3/mapserverstudio/data/natural_earth_vector.gpkg</SrcDataSource>
    <SrcLayer>ne_10m_admin_0_countries</SrcLayer>
    </OGRVRTLayer>
    <OGRVRTLayer name='energy'>
    <SrcDataSource>/vsicurl/https://nyc3.digitaloceanspaces.com/owid-public/data/energy/owid-energy-data.csv</SrcDataSource>
    <SrcSQL dialect='sqlite'>SELECT iso_code, fossil_share_elec, nuclear_share_elec, renewables_share_elec FROM \"owid-energy-data\" WHERE year = '2020'</SrcSQL>
    </OGRVRTLayer>
</OGRVRTDataSource>]]></SrcDataSource>
    <SrcSQL>SELECT c.*,fossil_share_elec,nuclear_share_elec,renewables_share_elec FROM countries c LEFT JOIN energy e ON c.ISO_A3 = e.iso_code</SrcSQL>
    </OGRVRTLayer>
</OGRVRTDataSource>"
        DATA "joined"
        EXTENT -180.0 -90.0 180.0 90
        TYPE CHART
        PROCESSING "CHART_TYPE=pie"
        PROCESSING "CHART_SIZE=35"
        CLASS
            NAME "Electricity from Fossil Fuels"
            STYLE
                SIZE [fossil_share_elec]
                COLOR "#313330"
            END
        END
        CLASS
            NAME "Electricity from Nuclear"
            STYLE
                SIZE [nuclear_share_elec]
                COLOR "#f0ba32"
            END
        END
        CLASS
            NAME "Electricity from Renewables"
            STYLE
                SIZE [renewables_share_elec]
                COLOR "#29b675"
            END
        END
    END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Use CDATA for nested data sources
            - Use SQL to JOIN and select from the data sources
            - Set the LAYER to TYPE CHART and set properties
            - https://app.mapserverstudio.net/#z-JMqsSu
        </script>
    </span>
</section>

<section data-background="images/smoothing-6-3.png" data-background-size="70%" data-background-color="white">
    <h1 style="color:black">Smoothing Shapes</h1>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="4">
LAYER
    NAME "lakes-smooth"
    TYPE POLYGON
    GEOMTRANSFORM (smoothsia([shape],6,3))
    CONNECTIONTYPE OGR
    CONNECTION "/data/naturalearth/fgb"
    DATA "ne_10m_lakes"
...
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Smooth a vector layer for a better rendering
            - Uses the SIA algorithm: Smoothing via Iterative Averaging.
            - https://app.mapserverstudio.net/#iSCZaMdN
        </script>
    </span>
</section>

<section data-background="images/vector_tiles.png" data-background-size="90%" data-background-color="white">
    <h1 style="color:black">Vector Tiles</h1>
</section>

<section>
    <pre><code class="language-python" data-trim data-line-numbers="4-5">
OUTPUTFORMAT
    NAME "mvt"
    DRIVER "MVT"
    FORMATOPTION "EDGE_BUFFER=20"
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Add the MVT format to the Mapfile
            - https://geographika.github.io/mapserver-mvt/
            - https://github.com/geographika/mapserver-mvt
        </script>
    </span>
</section>


<section>
    <pre><code class="language-python" data-trim data-line-numbers="4-5">
CLASSITEM "ADM0_A3"
CLASS
    EXPRESSION {ATA}
    STYLE
        COLOR "#F0F8FF"
    END
END
CLASS
    EXPRESSION {AFG,ALD,BEN,BLR,BWA,COK,COL,DNK,DOM,ERI,FIN,FRA,FRO,GIB,GNB,GNQ,GRC,GTM,JPN,KIR,LKA,MHL,MMR,MWI,NCL,OMN,RWA,SDS,SMR,SVK,SYR,TCD,TON,URY,WLF}
    STYLE
        COLOR "#fdaf6b"
    END
END
CLASS
    EXPRESSION {AZE,BGD,CHL,CMR,CSI,DEU,DJI,GUY,HUN,IOA,JAM,LBN,LBY,LSO,MDG,MKD,MNG,MRT,NIU,NZL,PCN,PYF,SAU,SHN,STP,TTO,UGA,UZB,ZMB}
    STYLE
        COLOR "#fdc663"
    END
END
</code></pre>
    <span data-markdown>
        <script type="text/template">
            - Add the MVT format to the Mapfile
            - https://geographika.github.io/mapserver-mvt/
            - https://github.com/geographika/mapserver-mvt
        </script>
    </span>
</section>

<section>
    <video data-autoplay data-loop data-controls src="images/demo.mp4"></video>
</section>



